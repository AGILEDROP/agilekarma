
# Travis CI configuration for Working PlusPlus++
#
# @see https://docs.travis-ci.com/user/languages/javascript-with-nodejs/
# @see https://docs.travis-ci.com/user/database-setup/#postgresql
# @author Tim Malone <tdmalone@gmail.com>

language: node_js
node_js: 10.8.0

services:
  - postgresql

# Support upgrading to PostgreSQL 10, as the default build images don't support it yet.
# (We run the install script in before_install below)
# @see https://github.com/travis-ci/travis-ci/issues/8537#issuecomment-354020356
sudo: required
addons:
  postgresql: 9.6

cache:
  yarn: true
  directories:
    - node_modules

before_install:

  # Upgrade Yarn to the version specified in package.json.
  - curl --location https://yarnpkg.com/install.sh | bash -s -- --version "$( node -e "console.log(require('./package.json').engines.yarn)" )"
  - export PATH="$HOME/.yarn/bin:$PATH"

  # Upgrade to PostgreSQL 10.
  - ./.travis-postgres10.sh

install:
  - yarn --frozen-lockfile

before_script:
  - psql --command="CREATE DATABASE plusplus_tests;" --username="postgres"

script:
  - yarn lint
  - yarn test

after_script:
  - yarn report-coverage

# On success, deployments are automatically handled by Heroku.

notifications:
  email: false
  slack:
    on_start: always
    rooms:
      - secure: efl6ZdfE6OTOK5L2z5m993uultsT5WanZ5sn8EmHPa0ENd2+SKXIIigQ1EqbLm1zExWLMKA3Pq5pbHwndsnWywGkZDXWy2eHoSHk7IEVLLvAceyLUr5h2pBL8wztqWGZDMBo1tHGYddQsyBlCs52AQM04i+XBX4tYiUhub7AAbMQ9cqBIz09fRZ9JBNxM6HzMvj+PmeezXzFxvzgvmVQawGQUvJPaZuf9qcwJN1ZWw0FNkIwg3Aafe809mnQnzYIwmiC9kF+ZJ14BX4qqW7uzbo7Zsf647a8LSm9OI3fWzGdNnScWXv+hkWyfHAj8cz4yI2y5l+F3Muhwylp2wHGzjARJTLQq3HTFWaAnZtpyd82FB8v82qKPaPpKTeLcVkdib/E9XjYsdFdsC33jr5vc0j/oM/bLi9pA0faWwN4kq6Q9k3Ei2u+WnP4G7Fzb1WR7zZoLmT9k4BVOJFLYF++OirE9GPaKTvRMnOaR/RO/rQkOx2FlrtzfoG//NBULycMbEMmrv4/GJ64SHQ7YtnedaEb1NwXi/qTwdDtjXkmAeNRoNayHvLLZKG3GKsUze3VIrieN8qMCTRdXRttQd3hacPYNtoCqcB7ogIMN/Jg7v1g2l2szs/v2waNMJW18Hoj3PD8dDSrH/VXlDjaqCNFxo5/sBeHC6eJtW6EkCgzCY4=

env:
  global:

    # CODACY_PROJECT_TOKEN
    - secure: C0Ag7Bhn1xJPowuHmxfoECq9/kj+4EBzQTovFBnlWCXZVwFvrKAAj+tTXoOZqDbd5YXI85I5pfSPOxrA8BGcgcBmZKowabMJdI87Mg6F4LNvWO2k6MFt9T6F3BCD16vhPp5CqxYuDbuy+mBkpiXCuUgQF/F3ddV4Dst5GcgjLRa9FD+RCs0AuVHUKZpExBuU5AyaXUeCgusBzbt+KNH6TMiMXMGtL/4uAwUIo/pLafdC/mraut6m+pWP18lzFgmU/ycXIvtj01gMIPOm8RdW4LfAzgvSqxZWxLhNJSpA4vXKhTFamz5eig/FYfu73XVSmA4BNgM2jHR3nM16O8HVKS3gKgWIgbrxoHmTqTTmjfHvF4KE8fRu3LtcB4RQqahrtEq2/XHPHbcyOK4ZlP2Uu0IADO+nEo65/IhrBB5rlWUrSwOWTxnNMgS8OY9nKJhCbUOnXZEATadM1VTTaS71deJMRCjufKY6FvlBkArd9tvzI1Tc1RG/EcqvjvcVLzKhOvmhXPj0or3oKgtFnAD+fnHSczdYLectGCPja8euX9zZVJ3XFv2ASy+cK7jSolZidBigSLeboYwTwaJRVMf46oB4sbe0rVK+/pi9qW6hO/f+OS5yxcgwdm3Tf2AR3xi9KD3pa5iR0tnnArNjMsPaB0Espih4M70BGVXqBE3sgs8=
